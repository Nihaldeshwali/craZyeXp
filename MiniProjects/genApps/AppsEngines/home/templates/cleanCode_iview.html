<html>
  <head>
  <title> {{name}} | cleanCode </title>


    <link rel="stylesheet" type="text/css" href="/media/css/concat.css"> 
    <link rel="stylesheet" href="http://codemirror.net/lib/codemirror.css">
    <link rel="stylesheet" type="text/css" href="/media/css/texfonts.css">
    <script src="/media/js/jquery.min.js"></script>
    <script src="/media/js/concat.js"></script>
    <script src="/media/js/angular.min.js"></script>
  <style>
    .latex{

  }
    body{border: 4px solid #81c784; height: auto;}
    .container{height: 100%;}    
    .CodeMirror {
      border: 1px solid #eee;
      height: 100%!important;
    }
    .CodeMirror-scroll{height: auto;}
    .p.bar{padding-left:5px}

    .left{
      width: calc(50% - 1px);
      padding:2px;
      height:100%;
      display:inline-block;
      border-right:1px red solid;
    }
    .right{
      display: inline-block;
      float: right;
      height: 100%;
      padding: 5px 15px;
      width: 50%;
    }
    .iview{
	  color: black;
    display: block;

    padding-bottom: 8px;
    font-family: 'cmr10';
    font-size: 100%;
    line-height: 150%;
}
  </style>

</head>


<body>
<div class="container">
  <div class="p f18 b inv-color bar"> {{id}}# {{name}} : {{short_desc}} </div>
  <div style="display:inline-block; width:100%;height:calc( 100% - 36px);">
    <div class="left">
      <textarea id="c-code1">{{main}}</textarea>
    </div>
    
    <div class="right latex">
      <div align="justify" class="iview 1"> {% autoescape off %}{{full_desc}} {% endautoescape %}</div>
      <div align="justify" class="iview 2"> {% autoescape off %}{{intro}}{% endautoescape %}</div>
	  
      <div class="iview 3 codeExp"> OK! let's think how to solve it in worst way : <br> {{intro}} </div>
	  <div class="iview 4 codeExp"> OK! let's think how to solve it in worst way : <br> {{intro}} </div>
	  <div class="iview 5 codeExp"> OK! let's think how to solve it in worst way : <br> {{intro}} </div>
	  <div class="iview 6 codeExp"> OK! let's think how to solve it in worst way : <br> {{intro}} </div>
	  <div class="iview 7"> OK! let's think how to solve it in worst way : <br> {{intro}} </div>
    </div>
  </div>
</div>

<script src="http://codemirror.net/lib/codemirror.js"></script>
<script src="http://codemirror.net/addon/edit/matchbrackets.js"></script>
<script src="http://codemirror.net/mode/clike/clike.js"></script>

<script>
  function dis(id){
  var cEditor = CodeMirror.fromTextArea(document.getElementById(id), {
    lineNumbers: true,
    matchBrackets: true,
    readOnly: true,
    viewportMargin: Infinity,
    mode: "text/x-csrc"
  });
  }
  dis("c-code1");
</script>
<style>
/* Code Mirror */
.CodeMirror {
    height: 100%;
}
.CodeMirror-code > div{
  line-height: 1.5;
}
.CodeMirror-gutters {
  min-height:100% !important;
  z-index: 0;
}
</style>

<script>
/* My expand will expand a list of for code editor line number */
var myExpand = (function (a) {
  a=a.split('/')
  var s=[]
  function mySplit(str){
     str = str.split(",");
     console.log(str)
     o =[] 

     for(ii=0;ii<str.length;ii++){
       t = str[ii]
       idx = t.indexOf("-")
       console.log(idx);
       if(idx > -1){
         for(j=parseInt(t.substr(0,idx));j<=parseInt(t.substr(idx+1,t.length));j++){
             o.push(j);
         }
       }
       else{
         o.push(parseInt(t))
       }
     }
     return o;
  }

  for (k=0;k<a.length;k++)
    s.push(mySplit(a[k]));
  return s;
});
codeseg = myExpand('1-3,16-22/4-7/8-11/12-15') 

function heightlight(seg){
   loc = codeseg[seg]
   $( ".CodeMirror-code > div ").css('background','white')
   for ( i = 0;i<loc.length;i++){
     $( ".CodeMirror-code > div:nth-child("+loc[i]+")" ).css('background','lightyellow')	 
   }
}
function hideCodeSeg(seg){
   loc = codeseg[seg]
   for ( i = 0;i<loc.length;i++){
     $( ".CodeMirror-code > div:nth-child("+loc[i]+")" ).css('opacity', '.2')
   }
   if(seg>0){
    heightlight(seg-1);
   }
}
function showCodeSeg(seg){
   loc = codeseg[seg]
   for ( i = 0;i<loc.length;i++){
     $( ".CodeMirror-code > div:nth-child("+loc[i]+")" ).css('opacity', '1')	 
   }   
   heightlight(seg);
}


$( document ).ready(function() {
    console.log( "ready!" );
	$('.iview').hide();
	if($('.codeExp').length != codeseg.length ){
	  alert('Code Segment binding failed ! Iview Will not work !!!')
	}
});

var curIdx= 0; //display desc
var curCodeIdx = -1; //display code segment
function eduNext(){
   if($('.iview.'+(curIdx+1))[0] == undefined){return;}
   curIdx++;
   $('.iview.'+curIdx).fadeIn();
   
   if( curCodeIdx >= codeseg.length-1){return;} // we expand last code segment .. go back..
   if ($('.iview.'+curIdx).hasClass('codeExp')){
     if(curCodeIdx == -1){
       $( ".CodeMirror-code > div").css('opacity', '.2')
	 }
	 curCodeIdx++;
	 showCodeSeg(curCodeIdx); 
   }
}

function eduPrev(){

   if(curIdx ==0 ) return;
   $('.iview.'+curIdx).fadeOut();
   curIdx--;

   if( curCodeIdx == -1){return;}
   if ($('.iview.'+curIdx).hasClass('codeExp')){
     hideCodeSeg(curCodeIdx);
     curCodeIdx--;   
  }
}

// code for iterative Education..
  addEventListener("keydown", function(event) {
    if (event.keyCode == 39 || event.keyCode== 40){
	eduNext();
	}
	if (event.keyCode == 37 || event.keyCode== 38){
	eduPrev();
	}
  });

</script>


</body>
</html>